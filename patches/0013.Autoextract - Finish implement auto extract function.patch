From 5ad3f9e5823e369fe42a5af18116a5d715333cf5 Mon Sep 17 00:00:00 2001
From: Himmelt <master@void-3.cn>
Date: Mon, 17 Feb 2025 11:48:56 +0800
Subject: [PATCH] Implement auto extract function

---
 CPP/7zip/UI/FileManager/App.cpp | 21 ++++++++++++++++++++-
 1 file changed, 20 insertions(+), 1 deletion(-)

diff --git a/CPP/7zip/UI/FileManager/App.cpp b/CPP/7zip/UI/FileManager/App.cpp
index d740bc9e..062daa0b 100644
--- a/CPP/7zip/UI/FileManager/App.cpp
+++ b/CPP/7zip/UI/FileManager/App.cpp
@@ -650,6 +650,22 @@ void CApp::OnCopy(bool move, bool copyToSame, unsigned srcPanelIndex, bool _auto
       destPath = srcPanel.GetFsPath();
     destPath += correctName;
 
+    if (_auto) {
+		// 添加父文件夹名
+        UString archiveName = srcPanel.GetFsPath();
+        int posx = archiveName.ReverseFind_PathSepar();
+		if (posx == int(archiveName.Len() - 1)) {
+			archiveName.DeleteBack();
+			posx = archiveName.ReverseFind_PathSepar();
+		}
+        if (posx >= 0) {
+            archiveName.DeleteFrontal((unsigned)(posx + 1));
+            archiveName.DeleteFrom(archiveName.ReverseFind(L'.'));
+            destPath += archiveName;
+            destPath.Add_PathSepar();
+        }
+    }
+
     #if defined(_WIN32) && !defined(UNDER_CE)
     if (destPath.Len() != 0 && destPath[0] == '\\')
       if (destPath.Len() == 1 || destPath[1] != '\\')
@@ -699,7 +715,7 @@ void CApp::OnCopy(bool move, bool copyToSame, unsigned srcPanelIndex, bool _auto
         {
           srcPanel.MessageBoxError2Lines(basePath, ERROR_FILE_NOT_FOUND); // GetLastError()
           return;
-        }
+      }
         destIsFsPath = true;
         */
       }
@@ -854,6 +870,9 @@ void CApp::OnCopy(bool move, bool copyToSame, unsigned srcPanelIndex, bool _auto
   disableNotify1.Restore();
   disableNotify2.Restore();
   srcPanel.SetFocusToList();
+
+  ShellExecuteW(NULL, L"open", destPath, NULL, NULL, SW_SHOW);
+  exit(EXIT_SUCCESS);
 }
 
 void CApp::OnSetSameFolder(unsigned srcPanelIndex)
