From 3b75d1015b12840f934eac836c552083629ddbcc Mon Sep 17 00:00:00 2001
From: Lichtenshtein <altruumann@protonmail.com>
Date: Tue, 11 Nov 2025 13:51:51 +0300
Subject: [PATCH] abc 7z-extended command-line options

---
 CPP/Common/Wildcard.cpp | 20 +++++++++++++++++++-
 CPP/Common/Wildcard.h   |  1 +
 2 files changed, 20 insertions(+), 1 deletion(-)

diff --git a/CPP/Common/Wildcard.cpp b/CPP/Common/Wildcard.cpp
index b561a89..b198dfd 100644
--- a/CPP/Common/Wildcard.cpp
+++ b/CPP/Common/Wildcard.cpp
@@ -610,8 +610,17 @@ void CCensor::AddItem(ECensorPathMode pathMode, bool include, const UString &pat
   if (path.IsEmpty())
     throw "Empty file path";
 
+// by abc321
+  UString path2 = path;
+  bool Reverse = false;
+  if (path.Len() > 1 && (UString)(path.RightPtr(2)) == L"$?") {
+      Reverse = true;
+      path2 = path.Left(path.Len() - 2);
+  }
+// by abc321
+
   UStringVector pathParts;
-  SplitPathToParts(path, pathParts);
+  SplitPathToParts(path2, pathParts); // by abc321 - path variable changed to path2
 
   CCensorPathProps props2 = props;
 
@@ -726,12 +735,21 @@ void CCensor::AddItem(ECensorPathMode pathMode, bool include, const UString &pat
     // return; // for debug : ignore item (don't create Item)
   }
   */
+  
+  // by abc321
+  if (Reverse) {
+      forFile = true;
+      forDir = true;
+      props2.Recursive = false;
+  }
+  // by abc321
 
   CItem item;
   item.PathParts = pathParts;
   item.ForDir = forDir;
   item.ForFile = forFile;
   item.Recursive = props2.Recursive;
+  item.Reverse = Reverse; // by abc321
   item.WildcardMatching = props2.WildcardMatching;
   Pairs[(unsigned)index].Head.AddItem(include, item, ignoreWildcardIndex);
 }
diff --git a/CPP/Common/Wildcard.h b/CPP/Common/Wildcard.h
index 4f81da9..b7f2981 100644
--- a/CPP/Common/Wildcard.h
+++ b/CPP/Common/Wildcard.h
@@ -36,6 +36,7 @@ struct CItem
   bool Recursive;
   bool ForFile;
   bool ForDir;
+  bool Reverse; // by abc321
   bool WildcardMatching;
   
   #ifdef _WIN32
-- 
2.49.0.windows.1

